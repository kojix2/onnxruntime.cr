{"repository_name":"onnxruntime","body":"# onnxruntime.cr\n\n[![build](https://github.com/kojix2/onnxruntime.cr/actions/workflows/test.yml/badge.svg)](https://github.com/kojix2/onnxruntime.cr/actions/workflows/test.yml)\n[![Lines of Code](https://img.shields.io/endpoint?url=https%3A%2F%2Ftokei.kojix2.net%2Fbadge%2Fgithub%2Fkojix2%2Fonnxruntime.cr%2Flines)](https://tokei.kojix2.net/github/kojix2/onnxruntime.cr)\n\n[ONNX Runtime](https://github.com/Microsoft/onnxruntime) bindings for Crystal\n\n## Installation\n\n1. Install ONNX Runtime\n\n   Download and install the ONNX Runtime from the [official releases](https://github.com/microsoft/onnxruntime/releases).\n\n   For Linux:\n\n   ```bash\n   # Example for Linux\n   wget https://github.com/microsoft/onnxruntime/releases/download/v1.21.0/onnxruntime-linux-x64-1.21.0.tgz\n   tar -xzf onnxruntime-linux-x64-1.21.0.tgz\n   export ONNXRUNTIMEDIR=/path/to/onnxruntime-linux-x64-1.21.0\n   ```\n\n   For macOS:\n\n   ```bash\n   # Example for macOS\n   wget https://github.com/microsoft/onnxruntime/releases/download/v1.21.0/onnxruntime-osx-x86_64-1.21.0.tgz\n   tar -xzf onnxruntime-osx-x86_64-1.21.0.tgz\n   export ONNXRUNTIMEDIR=/path/to/onnxruntime-osx-x86_64-1.21.0\n   ```\n\n   For Windows:\n\n   ```powershell\n   # Example for Windows\n   # Download from https://github.com/microsoft/onnxruntime/releases\n   # Extract and set environment variable\n   $env:ONNXRUNTIMEDIR = \"C:\\path\\to\\onnxruntime-win-x64-1.21.0\"\n   ```\n\n2. Add the dependency to your `shard.yml`:\n\n   ```yaml\n   dependencies:\n     onnxruntime:\n       github: kojix2/onnxruntime.cr\n   ```\n\n3. Run `shards install`\n\n## Usage\n\n```crystal\nrequire \"onnxruntime\"\n\n# Load a model\nmodel = OnnxRuntime::Model.new(\"path/to/model.onnx\")\n\n# Print model inputs and outputs\nputs \"Inputs:\"\nmodel.inputs.each do |input|\n  puts \"  #{input[:name]}: #{input[:type]} #{input[:shape]}\"\nend\n\nputs \"Outputs:\"\nmodel.outputs.each do |output|\n  puts \"  #{output[:name]}: #{output[:type]} #{output[:shape]}\"\nend\n\n# Prepare input data\ninput_data = {\n  \"input_name\" => [1.0_f32, 2.0_f32, 3.0_f32]\n}\n\n# Run inference\nresult = model.predict(input_data)\n\n# Process results\nresult.each do |name, data|\n  puts \"#{name}: #{data}\"\nend\n```\n\n### Example with MNIST\n\n## MNIST Example\n\nDownload the MNIST model: [mnist-12.onnx](https://github.com/onnx/models/blob/main/validated/vision/classification/mnist/model/mnist-12.onnx)\n\n```crystal\nrequire \"onnxruntime\"\n\n# Load the MNIST model\nmodel = OnnxRuntime::Model.new(\"mnist.onnx\")\n\n# Create a dummy input (28x28 image draw 1)\ninput_data = Array(Float32).new(28 * 28) { |i| (i % 14 == 0 ? 1.0 : 0.0).to_f32 }\n\n# Run inference\nresult = model.predict({\"Input3\" => input_data}, [\"Plus214_Output_0\"], shape: {\"Input3\" => [1_i64, 1_i64, 28_i64, 28_i64]})\n\n# Get the output probabilities\nprobabilities = result[\"Plus214_Output_0\"].as(Array(Float32))\n\n# Find the digit with highest probability\npredicted_digit = probabilities.index(probabilities.max)\nputs \"Predicted digit: #{predicted_digit}\"\n\n# Explicitly release resources\nmodel.release\nOnnxRuntime::InferenceSession.release_env\n```\n\n## Memory Management\n\nCurrently, this library requires explicit resource management as reference counting is not yet fully implemented. To prevent memory leaks, you must explicitly release resources when you're done with them:\n\n```crystal\n# Create and use model\nmodel = OnnxRuntime::Model.new(\"path/to/model.onnx\")\nresult = model.predict(input_data)\n\n# When finished, explicitly release resources\nmodel.release\nOnnxRuntime::InferenceSession.release_env\n```\n\nFor long-running applications like web servers, consider setting up signal handlers to ensure resources are properly released on shutdown:\n\n```crystal\nSignal::INT.trap do\n  puts \"Shutting down...\"\n  model.release\n  OnnxRuntime::InferenceSession.release_env\n  exit\nend\n```\n\nSee the examples directory for more detailed implementations.\n\n## Development\n\nThe code is generated by AI and may not be perfect.\nPlease feel free to contribute and improve it.\n\n## Contributing\n\n1. Fork it (<https://github.com/kojix2/onnxruntime.cr/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n","program":{"html_id":"onnxruntime/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"onnxruntime","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"onnxruntime/OnnxRuntime","path":"OnnxRuntime.html","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime","abstract":false,"locations":[{"filename":"src/onnxruntime.cr","line_number":8,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime.cr#L8"},{"filename":"src/onnxruntime/inference_session.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L1"},{"filename":"src/onnxruntime/libonnxruntime.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/libonnxruntime.cr#L1"},{"filename":"src/onnxruntime/model.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L1"},{"filename":"src/onnxruntime/ort_environment.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L1"},{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L1"},{"filename":"src/onnxruntime/version.cr","line_number":1,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/version.cr#L1"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.0\""}],"class_methods":[{"html_id":"block_sparse_tensor(values,indices,dense_shape)-class-method","name":"block_sparse_tensor","doc":"Create a BlockSparse format sparse tensor","summary":"<p>Create a BlockSparse format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":""},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values, indices, dense_shape)","args_html":"(values, indices, dense_shape)","location":{"filename":"src/onnxruntime.cr","line_number":20,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime.cr#L20"},"def":{"name":"block_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":""},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor.block_sparse(values, indices, dense_shape)"},"external_var":false},{"html_id":"coo_sparse_tensor(values,indices,dense_shape)-class-method","name":"coo_sparse_tensor","doc":"Create a COO format sparse tensor","summary":"<p>Create a COO format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":""},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values, indices, dense_shape)","args_html":"(values, indices, dense_shape)","location":{"filename":"src/onnxruntime.cr","line_number":10,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime.cr#L10"},"def":{"name":"coo_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":""},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor.coo(values, indices, dense_shape)"},"external_var":false},{"html_id":"csr_sparse_tensor(values,inner_indices,outer_indices,dense_shape)-class-method","name":"csr_sparse_tensor","doc":"Create a CSR format sparse tensor","summary":"<p>Create a CSR format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":""},{"name":"inner_indices","external_name":"inner_indices","restriction":""},{"name":"outer_indices","external_name":"outer_indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values, inner_indices, outer_indices, dense_shape)","args_html":"(values, inner_indices, outer_indices, dense_shape)","location":{"filename":"src/onnxruntime.cr","line_number":15,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime.cr#L15"},"def":{"name":"csr_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":""},{"name":"inner_indices","external_name":"inner_indices","restriction":""},{"name":"outer_indices","external_name":"outer_indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor.csr(values, inner_indices, outer_indices, dense_shape)"},"external_var":false}],"types":[{"html_id":"onnxruntime/OnnxRuntime/InferenceSession","path":"OnnxRuntime/InferenceSession.html","kind":"class","full_name":"OnnxRuntime::InferenceSession","name":"InferenceSession","abstract":false,"superclass":{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"onnxruntime/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/onnxruntime/inference_session.cr","line_number":2,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L2"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"},"class_methods":[{"html_id":"release_env-class-method","name":"release_env","doc":"Class method to explicitly release the environment\nThis method is now a wrapper around OrtEnvironment.instance.release","summary":"<p>Class method to explicitly release the environment This method is now a wrapper around OrtEnvironment.instance.release</p>","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":619,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L619"},"def":{"name":"release_env","visibility":"Public","body":"begin\n  OrtEnvironment.instance.release\nrescue ex\n  STDERR.puts(\"Error releasing ONNX Runtime environment: #{ex.message}\")\nend"},"external_var":false}],"constructors":[{"html_id":"new(path_or_bytes,**session_options)-class-method","name":"new","abstract":false,"args":[{"name":"path_or_bytes","external_name":"path_or_bytes","restriction":""}],"args_string":"(path_or_bytes, **session_options)","args_html":"(path_or_bytes, **session_options)","location":{"filename":"src/onnxruntime/inference_session.cr","line_number":21,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L21"},"def":{"name":"new","args":[{"name":"path_or_bytes","external_name":"path_or_bytes","restriction":""}],"double_splat":{"name":"session_options","external_name":"session_options","restriction":""},"visibility":"Public","body":"_ = allocate\n_.initialize(path_or_bytes, **session_options)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"allocator:Pointer(OnnxRuntime::LibOnnxRuntime::OrtAllocator)-instance-method","name":"allocator","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":11,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L11"},"def":{"name":"allocator","visibility":"Public","body":"@allocator"},"external_var":false},{"html_id":"api-instance-method","name":"api","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":13,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L13"},"def":{"name":"api","visibility":"Public","body":"(OnnxRuntime::LibOnnxRuntime.OrtGetApiBase.value.get_api.call(OnnxRuntime::LibOnnxRuntime::ORT_API_VERSION)).value"},"external_var":false},{"html_id":"check_status(status)-instance-method","name":"check_status","doc":"Make check_status public so it can be used by SparseTensor","summary":"<p>Make check_status public so it can be used by SparseTensor</p>","abstract":false,"args":[{"name":"status","external_name":"status","restriction":""}],"args_string":"(status)","args_html":"(status)","location":{"filename":"src/onnxruntime/inference_session.cr","line_number":598,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L598"},"def":{"name":"check_status","args":[{"name":"status","external_name":"status","restriction":""}],"visibility":"Public","body":"if status.null?\n  return\nend\n\nerror_code = api.get_error_code.call(status)\nerror_message = String.new(api.get_error_message.call(status))\napi.release_status.call(status)\n\nraise(\"ONNXRuntime Error: #{error_message} (#{error_code})\")\n"},"external_var":false},{"html_id":"finalize-instance-method","name":"finalize","doc":"Finalizer only releases session-specific resources\nEnvironment is managed separately and should be released explicitly by the user","summary":"<p>Finalizer only releases session-specific resources Environment is managed separately and should be released explicitly by the user</p>","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":41,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L41"},"def":{"name":"finalize","visibility":"Public","body":"release_session\nrelease_allocator\n"},"external_var":false},{"html_id":"inputs:Array({name:String,type:OnnxRuntime::LibOnnxRuntime::TensorElementDataType,shape:Array(Int64)})-instance-method","name":"inputs","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":11,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L11"},"def":{"name":"inputs","visibility":"Public","body":"@inputs"},"external_var":false},{"html_id":"outputs:Array({name:String,type:OnnxRuntime::LibOnnxRuntime::TensorElementDataType,shape:Array(Int64)})-instance-method","name":"outputs","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":11,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L11"},"def":{"name":"outputs","visibility":"Public","body":"@outputs"},"external_var":false},{"html_id":"release_allocator-instance-method","name":"release_allocator","doc":"Method to explicitly release the allocator\nNote: Default allocator may not need to be released, so commented out","summary":"<p>Method to explicitly release the allocator Note: Default allocator may not need to be released, so commented out</p>","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":56,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L56"},"def":{"name":"release_allocator","visibility":"Public","body":""},"external_var":false},{"html_id":"release_session-instance-method","name":"release_session","doc":"Method to explicitly release the session","summary":"<p>Method to explicitly release the session</p>","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":48,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L48"},"def":{"name":"release_session","visibility":"Public","body":"if @session_released\n  return\nend\nif @session\n  api.release_session.call(@session)\nend\n@session_released = true\n"},"external_var":false},{"html_id":"run(input_feed,output_names=nil,**run_options)-instance-method","name":"run","abstract":false,"args":[{"name":"input_feed","external_name":"input_feed","restriction":""},{"name":"output_names","default_value":"nil","external_name":"output_names","restriction":""}],"args_string":"(input_feed, output_names = nil, **run_options)","args_html":"(input_feed, output_names = <span class=\"n\">nil</span>, **run_options)","location":{"filename":"src/onnxruntime/inference_session.cr","line_number":176,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L176"},"def":{"name":"run","args":[{"name":"input_feed","external_name":"input_feed","restriction":""},{"name":"output_names","default_value":"nil","external_name":"output_names","restriction":""}],"double_splat":{"name":"run_options","external_name":"run_options","restriction":""},"visibility":"Public","body":"run_options_ptr = Pointer(LibOnnxRuntime::OrtRunOptions).null\ninput_tensors = [] of Pointer(LibOnnxRuntime::OrtValue)\n\nbegin\n  status = api.create_run_options.call(pointerof(run_options_ptr))\n  check_status(status)\n\n\n  if tag = run_options[\"tag\"]?\n    status = api.run_options_set_run_tag.call(run_options_ptr, tag.to_s)\n    check_status(status)\n  end\n\n  if level = run_options[\"log_severity_level\"]?\n    status = api.run_options_set_run_log_severity_level.call(run_options_ptr, level.to_i)\n    check_status(status)\n  end\n\n  if level = run_options[\"log_verbosity_level\"]?\n    status = api.run_options_set_run_log_verbosity_level.call(run_options_ptr, level.to_i)\n    check_status(status)\n  end\n\n\n  input_names = [] of String\n\n\n  shapes = run_options[\"shape\"]?.try do |__arg0|\n    __arg0.as(Hash(String, Array(Int64)))\n  end\n\n  input_feed.each do |name, data|\n    tensor = if ((data.is_a?(SparseTensorFloat32) || data.is_a?(SparseTensorInt32)) || data.is_a?(SparseTensorInt64)) || data.is_a?(SparseTensorFloat64)\n      data.to_ort_value(self)\n    else\n      if (shapes && shapes[name]?) && data.is_a?(Array)\n        create_tensor_with_shape(data, shapes[name])\n      else\n        create_tensor(data)\n      end\n    end\n    input_tensors << tensor\n    input_names << name\n  end\n\n\n  output_names = output_names || @outputs.map do |o|\n    o[:name]\n  end\n\n\n  output_tensors = Array(Pointer(LibOnnxRuntime::OrtValue)).new(output_names.size, Pointer(LibOnnxRuntime::OrtValue).null)\n\n\n  input_names_ptr = input_names.map do |name|\n    ort_string(name)\n  end\n  output_names_ptr = output_names.map do |name|\n    ort_string(name)\n  end\n\n  status = api.run.call(@session, run_options_ptr, input_names_ptr.to_unsafe, input_tensors.to_unsafe, input_tensors.size.to_u64, output_names_ptr.to_unsafe, output_names.size.to_u64, output_tensors.to_unsafe)\n  check_status(status)\n\n\n  result = {} of String => Array(Float32) | Array(Int32) | Array(Int64) | Array(Bool) | Array(UInt8) | Array(Int8) | Array(UInt16) | Array(Int16) | Array(UInt32) | Array(UInt64) | SparseTensorFloat32 | SparseTensorInt32 | SparseTensorInt64 | SparseTensorFloat64\n  output_names.each_with_index do |name, i|\n    tensor = output_tensors[i]\n\n    type_info = Pointer(LibOnnxRuntime::OrtTypeInfo).null\n    begin\n      status = api.get_type_info.call(tensor, pointerof(type_info))\n      check_status(status)\n\n      onnx_type = LibOnnxRuntime::OnnxType::TENSOR\n      status = api.get_onnx_type_from_type_info.call(type_info, pointerof(onnx_type))\n      check_status(status)\n\n      if onnx_type == LibOnnxRuntime::OnnxType::TENSOR\n        result[name] = extract_dense_tensor_data(tensor, type_info)\n      else\n        if onnx_type == LibOnnxRuntime::OnnxType::SPARSETENSOR\n          result[name] = extract_sparse_tensor_data(tensor)\n        else\n          raise(\"Unsupported ONNX type: #{onnx_type}\")\n        end\n      end\n    ensure\n      if type_info\n        api.release_type_info.call(type_info)\n      end\n    end\n\n    if tensor\n      api.release_value.call(tensor)\n    end\n  end\n\n  result\nensure\n  if run_options_ptr\n    api.release_run_options.call(run_options_ptr)\n  end\n\n\n  input_tensors.each do |tensor|\n    if tensor\n      api.release_value.call(tensor)\n    end\n  end\nend\n"},"external_var":false},{"html_id":"session:Pointer(OnnxRuntime::LibOnnxRuntime::OrtSession)-instance-method","name":"session","abstract":false,"location":{"filename":"src/onnxruntime/inference_session.cr","line_number":11,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/inference_session.cr#L11"},"def":{"name":"session","visibility":"Public","body":"@session"},"external_var":false}]},{"html_id":"onnxruntime/OnnxRuntime/Model","path":"OnnxRuntime/Model.html","kind":"class","full_name":"OnnxRuntime::Model","name":"Model","abstract":false,"superclass":{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"onnxruntime/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/onnxruntime/model.cr","line_number":2,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L2"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"},"constructors":[{"html_id":"new(path_or_bytes,**session_options)-class-method","name":"new","abstract":false,"args":[{"name":"path_or_bytes","external_name":"path_or_bytes","restriction":""}],"args_string":"(path_or_bytes, **session_options)","args_html":"(path_or_bytes, **session_options)","location":{"filename":"src/onnxruntime/model.cr","line_number":3,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L3"},"def":{"name":"new","args":[{"name":"path_or_bytes","external_name":"path_or_bytes","restriction":""}],"double_splat":{"name":"session_options","external_name":"session_options","restriction":""},"visibility":"Public","body":"_ = allocate\n_.initialize(path_or_bytes, **session_options)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"create_block_sparse_tensor(values:Array(T),indices,dense_shape)forallT-instance-method","name":"create_block_sparse_tensor","doc":"Create a BlockSparse format sparse tensor","summary":"<p>Create a BlockSparse format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values : Array(T), indices, dense_shape) forall T","args_html":"(values : Array(T), indices, dense_shape) forall T","location":{"filename":"src/onnxruntime/model.cr","line_number":61,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L61"},"def":{"name":"create_block_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor(T).block_sparse(values, indices, dense_shape)"},"external_var":false},{"html_id":"create_coo_sparse_tensor(values:Array(T),indices,dense_shape)forallT-instance-method","name":"create_coo_sparse_tensor","doc":"Create a COO format sparse tensor","summary":"<p>Create a COO format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values : Array(T), indices, dense_shape) forall T","args_html":"(values : Array(T), indices, dense_shape) forall T","location":{"filename":"src/onnxruntime/model.cr","line_number":51,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L51"},"def":{"name":"create_coo_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor(T).coo(values, indices, dense_shape)"},"external_var":false},{"html_id":"create_csr_sparse_tensor(values:Array(T),inner_indices,outer_indices,dense_shape)forallT-instance-method","name":"create_csr_sparse_tensor","doc":"Create a CSR format sparse tensor","summary":"<p>Create a CSR format sparse tensor</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"inner_indices","external_name":"inner_indices","restriction":""},{"name":"outer_indices","external_name":"outer_indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"args_string":"(values : Array(T), inner_indices, outer_indices, dense_shape) forall T","args_html":"(values : Array(T), inner_indices, outer_indices, dense_shape) forall T","location":{"filename":"src/onnxruntime/model.cr","line_number":56,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L56"},"def":{"name":"create_csr_sparse_tensor","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"inner_indices","external_name":"inner_indices","restriction":""},{"name":"outer_indices","external_name":"outer_indices","restriction":""},{"name":"dense_shape","external_name":"dense_shape","restriction":""}],"visibility":"Public","body":"SparseTensor(T).csr(values, inner_indices, outer_indices, dense_shape)"},"external_var":false},{"html_id":"finalize-instance-method","name":"finalize","doc":"Finalizer to release session resources","summary":"<p>Finalizer to release session resources</p>","abstract":false,"location":{"filename":"src/onnxruntime/model.cr","line_number":8,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L8"},"def":{"name":"finalize","visibility":"Public","body":"release"},"external_var":false},{"html_id":"inputs-instance-method","name":"inputs","abstract":false,"location":{"filename":"src/onnxruntime/model.cr","line_number":65,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L65"},"def":{"name":"inputs","visibility":"Public","body":"@session.inputs"},"external_var":false},{"html_id":"metadata-instance-method","name":"metadata","abstract":false,"location":{"filename":"src/onnxruntime/model.cr","line_number":73,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L73"},"def":{"name":"metadata","visibility":"Public","body":"{\"inputs\" => @session.inputs, \"outputs\" => @session.outputs}"},"external_var":false},{"html_id":"outputs-instance-method","name":"outputs","abstract":false,"location":{"filename":"src/onnxruntime/model.cr","line_number":69,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L69"},"def":{"name":"outputs","visibility":"Public","body":"@session.outputs"},"external_var":false},{"html_id":"predict(input_feed,output_names=nil,shape=nil,**run_options)-instance-method","name":"predict","abstract":false,"args":[{"name":"input_feed","external_name":"input_feed","restriction":""},{"name":"output_names","default_value":"nil","external_name":"output_names","restriction":""},{"name":"shape","default_value":"nil","external_name":"shape","restriction":""}],"args_string":"(input_feed, output_names = nil, shape = nil, **run_options)","args_html":"(input_feed, output_names = <span class=\"n\">nil</span>, shape = <span class=\"n\">nil</span>, **run_options)","location":{"filename":"src/onnxruntime/model.cr","line_number":17,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L17"},"def":{"name":"predict","args":[{"name":"input_feed","external_name":"input_feed","restriction":""},{"name":"output_names","default_value":"nil","external_name":"output_names","restriction":""},{"name":"shape","default_value":"nil","external_name":"shape","restriction":""}],"double_splat":{"name":"run_options","external_name":"run_options","restriction":""},"visibility":"Public","body":"formatted_input = format_input(input_feed)\n\n\nif shape\n  input_tensors = {} of String => Array(Float32) | Array(Int32) | Array(Int64) | Array(Bool) | Array(UInt8) | Array(Int8) | Array(UInt16) | Array(Int16) | Array(UInt32) | Array(UInt64) | SparseTensorFloat32 | SparseTensorInt32 | SparseTensorInt64 | SparseTensorFloat64\n\n  formatted_input.each do |name, data|\n    if shape[name]? && data.is_a?(Array)\n      input_tensors[name] = data\n    else\n      input_tensors[name] = data\n    end\n  end\n\n\n  run_options = run_options.merge({shape: shape})\n\n\n  result = @session.run(input_tensors, output_names, **run_options)\nelse\n  result = @session.run(formatted_input, output_names, **run_options)\nend\n\n\nformat_output(result)\n"},"external_var":false},{"html_id":"release-instance-method","name":"release","doc":"Explicitly release resources","summary":"<p>Explicitly release resources</p>","abstract":false,"location":{"filename":"src/onnxruntime/model.cr","line_number":13,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/model.cr#L13"},"def":{"name":"release","visibility":"Public","body":"if @session\n  @session.release_session\nend"},"external_var":false}]},{"html_id":"onnxruntime/OnnxRuntime/OrtEnvironment","path":"OnnxRuntime/OrtEnvironment.html","kind":"class","full_name":"OnnxRuntime::OrtEnvironment","name":"OrtEnvironment","abstract":false,"superclass":{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"onnxruntime/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/onnxruntime/ort_environment.cr","line_number":4,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L4"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"},"doc":"OrtEnvironment is a singleton class that manages the ONNX Runtime environment.\nIt ensures that only one environment exists per process and provides thread-safe access.","summary":"<p>OrtEnvironment is a singleton class that manages the ONNX Runtime environment.</p>","class_methods":[{"html_id":"instance-class-method","name":"instance","doc":"Get the singleton instance of OrtEnvironment","summary":"<p>Get the singleton instance of OrtEnvironment</p>","abstract":false,"location":{"filename":"src/onnxruntime/ort_environment.cr","line_number":13,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L13"},"def":{"name":"instance","visibility":"Public","body":"@@mutex.synchronize do\n  @@instance || (@@instance = new)\nend"},"external_var":false}],"instance_methods":[{"html_id":"api-instance-method","name":"api","doc":"Get the API","summary":"<p>Get the API</p>","abstract":false,"location":{"filename":"src/onnxruntime/ort_environment.cr","line_number":56,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L56"},"def":{"name":"api","visibility":"Public","body":"(OnnxRuntime::LibOnnxRuntime.OrtGetApiBase.value.get_api.call(OnnxRuntime::LibOnnxRuntime::ORT_API_VERSION)).value"},"external_var":false},{"html_id":"env-instance-method","name":"env","doc":"Get the environment pointer","summary":"<p>Get the environment pointer</p>","abstract":false,"location":{"filename":"src/onnxruntime/ort_environment.cr","line_number":27,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L27"},"def":{"name":"env","visibility":"Public","body":"if @released\n  raise(\"Environment has been released\")\nend\n@env\n"},"external_var":false},{"html_id":"release-instance-method","name":"release","doc":"Release the environment in a thread-safe manner","summary":"<p>Release the environment in a thread-safe manner</p>","abstract":false,"location":{"filename":"src/onnxruntime/ort_environment.cr","line_number":38,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L38"},"def":{"name":"release","visibility":"Public","body":"if @released\n  return\nend\n\n@@mutex.synchronize do\n  if @released\n    return\n  end\n\n  begin\n    api.release_env.call(@env)\n    @released = true\n    @@instance = nil\n  rescue ex\n    STDERR.puts(\"Error releasing ONNX Runtime environment: #{ex.message}\")\n  end\nend\n"},"external_var":false},{"html_id":"released?:Bool-instance-method","name":"released?","doc":"Check if the environment has been released","summary":"<p>Check if the environment has been released</p>","abstract":false,"location":{"filename":"src/onnxruntime/ort_environment.cr","line_number":33,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/ort_environment.cr#L33"},"def":{"name":"released?","visibility":"Public","body":"@released"},"external_var":false}]},{"html_id":"onnxruntime/OnnxRuntime/SparseTensor","path":"OnnxRuntime/SparseTensor.html","kind":"class","full_name":"OnnxRuntime::SparseTensor(T)","name":"SparseTensor","abstract":false,"superclass":{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"onnxruntime/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"onnxruntime/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":9,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L9"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"},"doc":"SparseTensor class provides high-level API for working with sparse tensors in ONNX Runtime.","summary":"<p>SparseTensor class provides high-level API for working with sparse tensors in ONNX Runtime.</p>","class_methods":[{"html_id":"block_sparse(values:Array(T),indices:Array,dense_shape:Array(Int64))forallT-class-method","name":"block_sparse","doc":"Creates a BlockSparse format sparse tensor.\n\n* `values` - The non-zero values in the sparse tensor\n* `indices` - The block indices\n* `dense_shape` - The shape of the dense tensor this sparse tensor represents","summary":"<p>Creates a BlockSparse format sparse tensor.</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"args_string":"(values : Array(T), indices : Array, dense_shape : Array(Int64)) forall T","args_html":"(values : Array(T), indices : Array, dense_shape : Array(Int64)) forall T","location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":61,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L61"},"def":{"name":"block_sparse","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"visibility":"Public","body":"indices_hash = {} of Symbol => Array(Int32) | Array(Int64)\n\nindices_hash[:block_indices] = indices.map(&.to_i32)\n\nnew(LibOnnxRuntime::SparseFormat::BLOCK_SPARSE, values, indices_hash, dense_shape)\n"},"external_var":false},{"html_id":"coo(values:Array(T),indices:Array,dense_shape:Array(Int64))forallT-class-method","name":"coo","doc":"Creates a COO format sparse tensor.\n\n* `values` - The non-zero values in the sparse tensor\n* `indices` - The indices data for the sparse tensor (2D array where each row is a coordinate)\n* `dense_shape` - The shape of the dense tensor this sparse tensor represents","summary":"<p>Creates a COO format sparse tensor.</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"args_string":"(values : Array(T), indices : Array, dense_shape : Array(Int64)) forall T","args_html":"(values : Array(T), indices : Array, dense_shape : Array(Int64)) forall T","location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":26,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L26"},"def":{"name":"coo","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"visibility":"Public","body":"indices_hash = {} of Symbol => Array(Int32) | Array(Int64)\n\nif indices.first.is_a?(Int32)\n  indices_hash[:coo_indices] = indices.flatten.as(Array(Int32))\nelse\n  indices_hash[:coo_indices] = indices.flatten.map(&.to_i64)\nend\n\nnew(LibOnnxRuntime::SparseFormat::COO, values, indices_hash, dense_shape)\n"},"external_var":false},{"html_id":"csr(values:Array(T),inner_indices:Array,outer_indices:Array,dense_shape:Array(Int64))forallT-class-method","name":"csr","doc":"Creates a CSR format sparse tensor.\n\n* `values` - The non-zero values in the sparse tensor\n* `inner_indices` - The column indices for each non-zero value\n* `outer_indices` - The row pointers indicating where each row starts in the values array\n* `dense_shape` - The shape of the dense tensor this sparse tensor represents","summary":"<p>Creates a CSR format sparse tensor.</p>","abstract":false,"args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"inner_indices","external_name":"inner_indices","restriction":"Array"},{"name":"outer_indices","external_name":"outer_indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"args_string":"(values : Array(T), inner_indices : Array, outer_indices : Array, dense_shape : Array(Int64)) forall T","args_html":"(values : Array(T), inner_indices : Array, outer_indices : Array, dense_shape : Array(Int64)) forall T","location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":47,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L47"},"def":{"name":"csr","args":[{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"inner_indices","external_name":"inner_indices","restriction":"Array"},{"name":"outer_indices","external_name":"outer_indices","restriction":"Array"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"visibility":"Public","body":"indices_hash = {} of Symbol => Array(Int32) | Array(Int64)\n\nindices_hash[:inner_indices] = inner_indices.map(&.to_i64)\nindices_hash[:outer_indices] = outer_indices.map(&.to_i64)\n\nnew(LibOnnxRuntime::SparseFormat::CSRC, values, indices_hash, dense_shape)\n"},"external_var":false}],"constructors":[{"html_id":"new(format:LibOnnxRuntime::SparseFormat,values:Array(T),indices:Hash(Symbol,Array(Int32)|Array(Int64)),dense_shape:Array(Int64))-class-method","name":"new","doc":"Creates a new SparseTensor instance.\n\n* `format` - The sparse tensor format (COO, CSR, or BLOCK_SPARSE)\n* `values` - The non-zero values in the sparse tensor\n* `indices` - The indices data for the sparse tensor (format-specific)\n* `dense_shape` - The shape of the dense tensor this sparse tensor represents","summary":"<p>Creates a new SparseTensor instance.</p>","abstract":false,"args":[{"name":"format","external_name":"format","restriction":"LibOnnxRuntime::SparseFormat"},{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Hash(Symbol, Array(Int32) | Array(Int64))"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"args_string":"(format : LibOnnxRuntime::SparseFormat, values : Array(T), indices : Hash(Symbol, Array(Int32) | Array(Int64)), dense_shape : Array(Int64))","args_html":"(format : LibOnnxRuntime::SparseFormat, values : Array(T), indices : Hash(Symbol, Array(Int32) | Array(Int64)), dense_shape : Array(Int64))","location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":18,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L18"},"def":{"name":"new","args":[{"name":"format","external_name":"format","restriction":"LibOnnxRuntime::SparseFormat"},{"name":"values","external_name":"values","restriction":"Array(T)"},{"name":"indices","external_name":"indices","restriction":"Hash(Symbol, Array(Int32) | Array(Int64))"},{"name":"dense_shape","external_name":"dense_shape","restriction":"Array(Int64)"}],"visibility":"Public","body":"_ = SparseTensor(T).allocate\n_.initialize(format, values, indices, dense_shape)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"dense_shape-instance-method","name":"dense_shape","abstract":false,"location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":10,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L10"},"def":{"name":"dense_shape","visibility":"Public","body":"@dense_shape"},"external_var":false},{"html_id":"format-instance-method","name":"format","abstract":false,"location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":10,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L10"},"def":{"name":"format","visibility":"Public","body":"@format"},"external_var":false},{"html_id":"indices-instance-method","name":"indices","abstract":false,"location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":10,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L10"},"def":{"name":"indices","visibility":"Public","body":"@indices"},"external_var":false},{"html_id":"to_ort_value(session)-instance-method","name":"to_ort_value","doc":"Converts the sparse tensor to an OrtValue that can be used with the ONNX Runtime API.\nNote: The caller is responsible for releasing the returned OrtValue using api.release_value.call(tensor)\n\n* `session` - The InferenceSession instance to use for creating the OrtValue","summary":"<p>Converts the sparse tensor to an OrtValue that can be used with the ONNX Runtime API.</p>","abstract":false,"args":[{"name":"session","external_name":"session","restriction":""}],"args_string":"(session)","args_html":"(session)","location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":73,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L73"},"def":{"name":"to_ort_value","args":[{"name":"session","external_name":"session","restriction":""}],"visibility":"Public","body":"api = session.api\nallocator = session.allocator\ntensor = Pointer(LibOnnxRuntime::OrtValue).null\nmemory_info = Pointer(LibOnnxRuntime::OrtMemoryInfo).null\n\nbegin\n  status = api.create_sparse_tensor_as_ort_value.call(allocator, @dense_shape.to_unsafe, @dense_shape.size.to_u64, element_data_type, pointerof(tensor))\n  session.check_status(status)\n\n\n  status = api.create_cpu_memory_info.call(LibOnnxRuntime::AllocatorType::DEVICE, LibOnnxRuntime::MemType::CPU, pointerof(memory_info))\n  session.check_status(status)\n\n\n  case @format\n  when LibOnnxRuntime::SparseFormat::COO\n    fill_coo_tensor(api, tensor, memory_info, session)\n  when LibOnnxRuntime::SparseFormat::CSRC\n    fill_csr_tensor(api, tensor, memory_info, session)\n  when LibOnnxRuntime::SparseFormat::BLOCK_SPARSE\n    fill_block_sparse_tensor(api, tensor, memory_info, session)\n  else\n    raise(\"Unsupported sparse format: #{@format}\")\n  end\n  tensor\nensure\n  if memory_info\n    api.release_memory_info.call(memory_info)\n  end\nend\n"},"external_var":false},{"html_id":"values-instance-method","name":"values","abstract":false,"location":{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":10,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L10"},"def":{"name":"values","visibility":"Public","body":"@values"},"external_var":false}]},{"html_id":"onnxruntime/OnnxRuntime/SparseTensorFloat32","path":"OnnxRuntime/SparseTensorFloat32.html","kind":"alias","full_name":"OnnxRuntime::SparseTensorFloat32","name":"SparseTensorFloat32","abstract":false,"locations":[{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":3,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L3"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":true,"aliased":"OnnxRuntime::SparseTensor(Float32)","aliased_html":"<a href=\"../OnnxRuntime/SparseTensor.html\">OnnxRuntime::SparseTensor(Float32)</a>","const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"},"doc":"Type aliases for common SparseTensor types","summary":"<p>Type aliases for common SparseTensor types</p>"},{"html_id":"onnxruntime/OnnxRuntime/SparseTensorFloat64","path":"OnnxRuntime/SparseTensorFloat64.html","kind":"alias","full_name":"OnnxRuntime::SparseTensorFloat64","name":"SparseTensorFloat64","abstract":false,"locations":[{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":6,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L6"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":true,"aliased":"OnnxRuntime::SparseTensor(Float64)","aliased_html":"<a href=\"../OnnxRuntime/SparseTensor.html\">OnnxRuntime::SparseTensor(Float64)</a>","const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"}},{"html_id":"onnxruntime/OnnxRuntime/SparseTensorInt32","path":"OnnxRuntime/SparseTensorInt32.html","kind":"alias","full_name":"OnnxRuntime::SparseTensorInt32","name":"SparseTensorInt32","abstract":false,"locations":[{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":4,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L4"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":true,"aliased":"OnnxRuntime::SparseTensor(Int32)","aliased_html":"<a href=\"../OnnxRuntime/SparseTensor.html\">OnnxRuntime::SparseTensor(Int32)</a>","const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"}},{"html_id":"onnxruntime/OnnxRuntime/SparseTensorInt64","path":"OnnxRuntime/SparseTensorInt64.html","kind":"alias","full_name":"OnnxRuntime::SparseTensorInt64","name":"SparseTensorInt64","abstract":false,"locations":[{"filename":"src/onnxruntime/sparse_tensor.cr","line_number":5,"url":"https://github.com/kojix2/onnxruntime.cr/blob/a6fadff76afb12490f22cbb7ada78b3db07f8b1c/src/onnxruntime/sparse_tensor.cr#L5"}],"repository_name":"onnxruntime","program":false,"enum":false,"alias":true,"aliased":"OnnxRuntime::SparseTensor(Int64)","aliased_html":"<a href=\"../OnnxRuntime/SparseTensor.html\">OnnxRuntime::SparseTensor(Int64)</a>","const":false,"namespace":{"html_id":"onnxruntime/OnnxRuntime","kind":"module","full_name":"OnnxRuntime","name":"OnnxRuntime"}}]}]}}